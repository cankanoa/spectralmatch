
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://spectralmatch.github.io/spectralmatch/api/match/">
      
      
        <link rel="prev" href="../../examples/mask_cloud/">
      
      
        <link rel="next" href="../mask/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Matching Algorithms - spectralmatch</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../docs/overrides/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spectralmatch.match.global_regression" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="spectralmatch" class="md-header__button md-logo" aria-label="spectralmatch" data-md-component="logo">
      
  <img src="../../images/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            spectralmatch
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Matching Algorithms
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/spectralmatch/spectralmatch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="spectralmatch" class="md-nav__button md-logo" aria-label="spectralmatch" data-md-component="logo">
      
  <img src="../../images/icon.png" alt="logo">

    </a>
    spectralmatch
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/spectralmatch/spectralmatch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/spectralmatch/spectralmatch/releases" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/spectralmatch/spectralmatch/issues" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Report Issues
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/example_global_to_local/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Global to Local
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/benchmark/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Benchmark Mulithreading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/calculate_statistics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calculate Statistics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/mask_cloud/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cloud Masking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../example/mask_ndvi.py" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vegetation Masking
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Matching Algorithms
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Matching Algorithms
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spectralmatch.match.global_regression" class="md-nav__link">
    <span class="md-ellipsis">
      global_regression
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spectralmatch.match.global_regression.global_regression" class="md-nav__link">
    <span class="md-ellipsis">
      global_regression
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spectralmatch.match.local_block_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      local_block_adjustment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spectralmatch.match.local_block_adjustment.local_block_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      local_block_adjustment
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mask/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Masking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../statistics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Statistics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handlers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spectralmatch.match.global_regression" class="md-nav__link">
    <span class="md-ellipsis">
      global_regression
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spectralmatch.match.global_regression.global_regression" class="md-nav__link">
    <span class="md-ellipsis">
      global_regression
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spectralmatch.match.local_block_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      local_block_adjustment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spectralmatch.match.local_block_adjustment.local_block_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      local_block_adjustment
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Matching Algorithms</h1>

<div class="doc doc-object doc-module">



<a id="spectralmatch.match.global_regression"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="spectralmatch.match.global_regression.global_regression" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">global_regression</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">,</span> <span class="n">output_image_folder</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">custom_mean_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">custom_std_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">output_global_basename</span><span class="o">=</span><span class="s1">&#39;_global&#39;</span><span class="p">,</span> <span class="n">vector_mask_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tile_width_and_height_tuple</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_nodata_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">calc_dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span></code>

<a href="#spectralmatch.match.global_regression.global_regression" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Matches multiple input raster images to a common global statistical range using overlapping areas
for deriving statistical adjustments. Adjustments include mean and standard deviation factors, ensuring
the images are globally consistent in derived values.</p>
<p>This function processes pairs of overlapping raster images to compute statistical parameters, combines
global statistics for the entire collection of raster images, and generates output raster images with
adjusted pixel values. Additional features such as custom nodata values, vector mask usage, and tiling
are supported. The function allows parallel processing to optimize performance.</p>
<p>Args:
input_image_paths (List[str]): Paths to input raster images.
output_image_folder (str): Directory where adjusted images will be saved.
custom_mean_factor (float): Scale factor for mean adjustment, default is 1.0.
custom_std_factor (float): Scale factor for standard deviation adjustment, default is 1.0.
output_global_basename (str): Global basename suffix added to output image filenames, default is "_global".
vector_mask_path (Optional[str]): Path to a vector mask file used to limit processing, optional.
tile_width_and_height_tuple (Optional[Tuple[int, int]]): Tuple specifying tile width and height for tiled processing, optional.
debug_mode (bool): Enables debug mode when set to True, default is False.
custom_nodata_value (float | None): Override nodata value for rasters, optional.
parallel (bool): Enables parallel processing when set to True, default is False.
max_workers (int | None): Maximum number of workers for parallel processing, default is None.
calc_dtype (str): Data type used for intermediate calculations, default is "float32".</p>
<p>Returns:
List[str]: Paths to the output adjusted raster images.</p>


            <details class="quote">
              <summary>Source code in <code>spectralmatch/match/global_regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">global_regression</span><span class="p">(</span>
    <span class="n">input_image_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">output_image_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">custom_mean_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">custom_std_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">output_global_basename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_global&quot;</span><span class="p">,</span>
    <span class="n">vector_mask_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tile_width_and_height_tuple</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">custom_nodata_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">calc_dtype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
    <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Matches multiple input raster images to a common global statistical range using overlapping areas</span>
<span class="sd">    for deriving statistical adjustments. Adjustments include mean and standard deviation factors, ensuring</span>
<span class="sd">    the images are globally consistent in derived values.</span>

<span class="sd">    This function processes pairs of overlapping raster images to compute statistical parameters, combines</span>
<span class="sd">    global statistics for the entire collection of raster images, and generates output raster images with</span>
<span class="sd">    adjusted pixel values. Additional features such as custom nodata values, vector mask usage, and tiling</span>
<span class="sd">    are supported. The function allows parallel processing to optimize performance.</span>

<span class="sd">    Args:</span>
<span class="sd">    input_image_paths (List[str]): Paths to input raster images.</span>
<span class="sd">    output_image_folder (str): Directory where adjusted images will be saved.</span>
<span class="sd">    custom_mean_factor (float): Scale factor for mean adjustment, default is 1.0.</span>
<span class="sd">    custom_std_factor (float): Scale factor for standard deviation adjustment, default is 1.0.</span>
<span class="sd">    output_global_basename (str): Global basename suffix added to output image filenames, default is &quot;_global&quot;.</span>
<span class="sd">    vector_mask_path (Optional[str]): Path to a vector mask file used to limit processing, optional.</span>
<span class="sd">    tile_width_and_height_tuple (Optional[Tuple[int, int]]): Tuple specifying tile width and height for tiled processing, optional.</span>
<span class="sd">    debug_mode (bool): Enables debug mode when set to True, default is False.</span>
<span class="sd">    custom_nodata_value (float | None): Override nodata value for rasters, optional.</span>
<span class="sd">    parallel (bool): Enables parallel processing when set to True, default is False.</span>
<span class="sd">    max_workers (int | None): Maximum number of workers for parallel processing, default is None.</span>
<span class="sd">    calc_dtype (str): Data type used for intermediate calculations, default is &quot;float32&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">    List[str]: Paths to the output adjusted raster images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start global matching&quot;</span><span class="p">)</span>

    <span class="n">_check_raster_requirements</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">)</span>

    <span class="n">nodata_val</span> <span class="o">=</span> <span class="n">_get_nodata_value</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">,</span> <span class="n">custom_nodata_value</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating statistics&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span> <span class="n">num_bands</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">count</span>
    <span class="n">num_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">)</span>

    <span class="n">all_bounds</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">all_bounds</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">bounds</span>

    <span class="n">overlapping_pairs</span> <span class="o">=</span> <span class="n">_find_overlaps</span><span class="p">(</span><span class="n">all_bounds</span><span class="p">)</span>

    <span class="n">all_overlap_stats</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">id_i</span><span class="p">,</span> <span class="n">id_j</span> <span class="ow">in</span> <span class="n">overlapping_pairs</span><span class="p">:</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">_calculate_overlap_stats</span><span class="p">(</span>
            <span class="n">num_bands</span><span class="p">,</span>
            <span class="n">input_image_paths</span><span class="p">[</span><span class="n">id_i</span><span class="p">],</span>
            <span class="n">input_image_paths</span><span class="p">[</span><span class="n">id_j</span><span class="p">],</span>
            <span class="n">id_i</span><span class="p">,</span>
            <span class="n">id_j</span><span class="p">,</span>
            <span class="n">all_bounds</span><span class="p">[</span><span class="n">id_i</span><span class="p">],</span>
            <span class="n">all_bounds</span><span class="p">[</span><span class="n">id_j</span><span class="p">],</span>
            <span class="n">nodata_val</span><span class="p">,</span>
            <span class="n">nodata_val</span><span class="p">,</span>
            <span class="n">vector_mask_path</span><span class="o">=</span><span class="n">vector_mask_path</span><span class="p">,</span>
            <span class="n">tile_width_and_height_tuple</span><span class="o">=</span><span class="n">tile_width_and_height_tuple</span><span class="p">,</span>
            <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">all_overlap_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">k_i</span><span class="p">:</span> <span class="p">{</span>
                    <span class="o">**</span><span class="n">all_overlap_stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k_i</span><span class="p">,</span> <span class="p">{}),</span>
                    <span class="o">**</span><span class="p">{</span>
                        <span class="n">k_j</span><span class="p">:</span> <span class="p">{</span><span class="o">**</span><span class="n">all_overlap_stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k_i</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k_j</span><span class="p">,</span> <span class="p">{}),</span> <span class="o">**</span><span class="n">s</span><span class="p">}</span>
                        <span class="k">for</span> <span class="n">k_j</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="p">},</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">k_i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="n">all_whole_stats</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">):</span>
        <span class="n">all_whole_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">_calculate_whole_stats</span><span class="p">(</span>
                <span class="n">input_image_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
                <span class="n">nodata</span><span class="o">=</span><span class="n">nodata_val</span><span class="p">,</span>
                <span class="n">num_bands</span><span class="o">=</span><span class="n">num_bands</span><span class="p">,</span>
                <span class="n">image_id</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span>
                <span class="n">vector_mask_path</span><span class="o">=</span><span class="n">vector_mask_path</span><span class="p">,</span>
                <span class="n">tile_width_and_height_tuple</span><span class="o">=</span><span class="n">tile_width_and_height_tuple</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="n">all_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_bands</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">num_images</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing band </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">num_images</span><span class="si">}</span><span class="s2"> images&quot;</span><span class="p">)</span>

        <span class="n">A</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tot_overlap</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_images</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_images</span><span class="p">):</span>
                <span class="n">stat</span> <span class="o">=</span> <span class="n">all_overlap_stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">stat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">stat</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>
                <span class="n">m1</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">stat</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span> <span class="n">stat</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
                <span class="n">m2</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">all_overlap_stats</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span>
                    <span class="n">all_overlap_stats</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">row_m</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_images</span><span class="p">)</span>
                <span class="n">row_s</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_images</span><span class="p">)</span>
                <span class="n">row_m</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">m1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">row_m</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">m2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">row_s</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">],</span> <span class="n">row_s</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span><span class="p">,</span> <span class="o">-</span><span class="n">v2</span>
                <span class="n">A</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">[</span><span class="n">v</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">custom_mean_factor</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row_m</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">v</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">custom_std_factor</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row_s</span><span class="p">],</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">y</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">tot_overlap</span> <span class="o">+=</span> <span class="n">s</span>
        <span class="n">pjj</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">tot_overlap</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">tot_overlap</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">num_images</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_images</span><span class="p">):</span>
            <span class="n">mj</span> <span class="o">=</span> <span class="n">all_whole_stats</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
            <span class="n">vj</span> <span class="o">=</span> <span class="n">all_whole_stats</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
            <span class="n">row_m</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_images</span><span class="p">)</span>
            <span class="n">row_s</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_images</span><span class="p">)</span>
            <span class="n">row_m</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mj</span> <span class="o">*</span> <span class="n">pjj</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">pjj</span><span class="p">]</span>
            <span class="n">row_s</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">vj</span> <span class="o">*</span> <span class="n">pjj</span>
            <span class="n">A</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">row_m</span><span class="p">,</span> <span class="n">row_s</span><span class="p">])</span>
            <span class="n">y</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">mj</span> <span class="o">*</span> <span class="n">pjj</span><span class="p">,</span> <span class="n">vj</span> <span class="o">*</span> <span class="n">pjj</span><span class="p">])</span>

        <span class="n">A_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="n">y_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">@</span> <span class="n">p</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_images</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span>
            <span class="n">overlap_pairs</span> <span class="o">=</span> <span class="n">overlapping_pairs</span>
            <span class="n">_print_constraint_system</span><span class="p">(</span>
                <span class="n">constraint_matrix</span><span class="o">=</span><span class="n">A_arr</span><span class="p">,</span>
                <span class="n">adjustment_params</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="n">observed_values_vector</span><span class="o">=</span><span class="n">y_arr</span><span class="p">,</span>
                <span class="n">overlap_pairs</span><span class="o">=</span><span class="n">overlap_pairs</span><span class="p">,</span>
                <span class="n">num_images</span><span class="o">=</span><span class="n">num_images</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">all_params</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_images</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">img_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_image_folder</span><span class="p">,</span> <span class="s2">&quot;Images&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">img_dir</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">img_dir</span><span class="p">)</span>
    <span class="n">out_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">parallel</span> <span class="ow">and</span> <span class="n">max_workers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_workers</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">img_idx</span><span class="p">,</span> <span class="n">img_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">):</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">img_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">img_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}{</span><span class="n">output_global_basename</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>
        <span class="n">out_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Apply adjustments and saving results for </span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_bands</span><span class="p">,</span> <span class="s2">&quot;nodata&quot;</span><span class="p">:</span> <span class="n">nodata_val</span><span class="p">})</span>
            <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">meta</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">tile_width_and_height_tuple</span><span class="p">:</span>
                    <span class="n">tw</span><span class="p">,</span> <span class="n">th</span> <span class="o">=</span> <span class="n">tile_width_and_height_tuple</span>
                    <span class="n">windows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_create_windows</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">th</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">windows</span> <span class="o">=</span> <span class="p">[</span><span class="n">Window</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">height</span><span class="p">)]</span>

                <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
                    <span class="n">ctx</span> <span class="o">=</span> <span class="n">_choose_context</span><span class="p">(</span><span class="n">prefer_fork</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">pool</span> <span class="o">=</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span>
                        <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
                        <span class="n">mp_context</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                        <span class="n">initializer</span><span class="o">=</span><span class="n">_init_worker</span><span class="p">,</span>
                        <span class="n">initargs</span><span class="o">=</span><span class="p">(</span><span class="n">img_path</span><span class="p">,),</span>
                    <span class="p">)</span>

                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">):</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">all_params</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">img_idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">b0</span> <span class="o">=</span> <span class="n">all_params</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">img_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
                        <span class="n">futs</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">pool</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">_process_tile_global</span><span class="p">,</span>
                                        <span class="n">w</span><span class="p">,</span>
                                        <span class="n">b</span><span class="p">,</span>
                                        <span class="n">a</span><span class="p">,</span>
                                        <span class="n">b0</span><span class="p">,</span>
                                        <span class="n">nodata_val</span><span class="p">,</span>
                                        <span class="n">calc_dtype</span><span class="p">,</span>
                                        <span class="n">debug_mode</span><span class="p">,</span>
                                        <span class="p">)</span>
                            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">windows</span>
                        <span class="p">]</span>
                        <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futs</span><span class="p">):</span>
                            <span class="n">win</span><span class="p">,</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">fut</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]),</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">win</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">win</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
                            <span class="n">_</span><span class="p">,</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">_process_tile_global</span><span class="p">(</span>
                                <span class="n">win</span><span class="p">,</span>
                                <span class="n">b</span><span class="p">,</span>
                                <span class="n">a</span><span class="p">,</span>
                                <span class="n">b0</span><span class="p">,</span>
                                <span class="n">nodata_val</span><span class="p">,</span>
                                <span class="n">debug_mode</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]),</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">win</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
                    <span class="n">pool</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished global matching&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="spectralmatch.match.local_block_adjustment"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="spectralmatch.match.local_block_adjustment.local_block_adjustment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">local_block_adjustment</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">,</span> <span class="n">output_image_folder</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output_local_basename</span><span class="o">=</span><span class="s1">&#39;_local&#39;</span><span class="p">,</span> <span class="n">custom_nodata_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_blocks_per_image</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">calculation_dtype_precision</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">,</span> <span class="n">output_dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">debug_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tile_width_and_height_tuple</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">correction_method</span><span class="o">=</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#spectralmatch.match.local_block_adjustment.local_block_adjustment" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Matches histograms of input raster images using local histogram matching approach.
This function processes raster images, adjusts their histograms locally based on
reference blocks, and saves the corrected images to the specified output directory.
The procedure operates block-wise on the raster images for local corrections and
supports parallel execution for performance optimization.</p>
<p>Args:
input_image_paths (List[str]): A list of paths to input raster image files.
output_image_folder (str): Directory path where the output images will be saved.
output_local_basename (str): Suffix for the output filenames indicating local
histogram matching, default is "_local".
custom_nodata_value (float | None): Custom value to represent no data areas;
if None, it is auto-detected from input rasters.
target_blocks_per_image (int): Approximate number of blocks to divide each
raster for local histogram matching, default is 100.
alpha (float): Scaling factor for adjustment when applying histogram corrections,
default is 1.0 (no scaling).
calculation_dtype_precision (str): The data type precision used internally
for corrections, default is "float32".
output_dtype (str): Data type of the output images, default is "float32".
projection (str): Coordinate reference system for the output rasters,
default is "EPSG:4326".
debug_mode (bool): Flag to enable saving intermediate block map for debugging,
default is False.
tile_width_and_height_tuple (Optional[Tuple[int, int]]): Optional tuple
specifying the width and height of tiles for processing input raster,
default is None.
correction_method (Literal["gamma", "linear"]): Method for histogram correction,
either "gamma" or "linear." Default is "gamma".
parallel (bool): If True, enables parallel processing for higher efficiency,
default is False.
max_workers (int | None): Limits the number of parallel workers, default is
None (uses system CPU count if parallel is True).</p>
<p>Returns:
List[str]: List of file paths to the output raster images that have been
locally histogram-matched.</p>


            <details class="quote">
              <summary>Source code in <code>spectralmatch/match/local_block_adjustment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">local_block_adjustment</span><span class="p">(</span>
    <span class="n">input_image_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">output_image_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">output_local_basename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_local&quot;</span><span class="p">,</span>
    <span class="n">custom_nodata_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_blocks_per_image</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">calculation_dtype_precision</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
    <span class="n">output_dtype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
    <span class="n">projection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span>
    <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">tile_width_and_height_tuple</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">correction_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;linear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span>
    <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Matches histograms of input raster images using local histogram matching approach.</span>
<span class="sd">    This function processes raster images, adjusts their histograms locally based on</span>
<span class="sd">    reference blocks, and saves the corrected images to the specified output directory.</span>
<span class="sd">    The procedure operates block-wise on the raster images for local corrections and</span>
<span class="sd">    supports parallel execution for performance optimization.</span>

<span class="sd">    Args:</span>
<span class="sd">    input_image_paths (List[str]): A list of paths to input raster image files.</span>
<span class="sd">    output_image_folder (str): Directory path where the output images will be saved.</span>
<span class="sd">    output_local_basename (str): Suffix for the output filenames indicating local</span>
<span class="sd">    histogram matching, default is &quot;_local&quot;.</span>
<span class="sd">    custom_nodata_value (float | None): Custom value to represent no data areas;</span>
<span class="sd">    if None, it is auto-detected from input rasters.</span>
<span class="sd">    target_blocks_per_image (int): Approximate number of blocks to divide each</span>
<span class="sd">    raster for local histogram matching, default is 100.</span>
<span class="sd">    alpha (float): Scaling factor for adjustment when applying histogram corrections,</span>
<span class="sd">    default is 1.0 (no scaling).</span>
<span class="sd">    calculation_dtype_precision (str): The data type precision used internally</span>
<span class="sd">    for corrections, default is &quot;float32&quot;.</span>
<span class="sd">    output_dtype (str): Data type of the output images, default is &quot;float32&quot;.</span>
<span class="sd">    projection (str): Coordinate reference system for the output rasters,</span>
<span class="sd">    default is &quot;EPSG:4326&quot;.</span>
<span class="sd">    debug_mode (bool): Flag to enable saving intermediate block map for debugging,</span>
<span class="sd">    default is False.</span>
<span class="sd">    tile_width_and_height_tuple (Optional[Tuple[int, int]]): Optional tuple</span>
<span class="sd">    specifying the width and height of tiles for processing input raster,</span>
<span class="sd">    default is None.</span>
<span class="sd">    correction_method (Literal[&quot;gamma&quot;, &quot;linear&quot;]): Method for histogram correction,</span>
<span class="sd">    either &quot;gamma&quot; or &quot;linear.&quot; Default is &quot;gamma&quot;.</span>
<span class="sd">    parallel (bool): If True, enables parallel processing for higher efficiency,</span>
<span class="sd">    default is False.</span>
<span class="sd">    max_workers (int | None): Limits the number of parallel workers, default is</span>
<span class="sd">    None (uses system CPU count if parallel is True).</span>

<span class="sd">    Returns:</span>
<span class="sd">    List[str]: List of file paths to the output raster images that have been</span>
<span class="sd">    locally histogram-matched.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start local matching&quot;</span><span class="p">)</span>
    <span class="n">_check_raster_requirements</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">)</span>

    <span class="n">nodata_val</span> <span class="o">=</span> <span class="n">_get_nodata_value</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">,</span> <span class="n">custom_nodata_value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global nodata value: </span><span class="si">{</span><span class="n">nodata_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">out_img_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_image_folder</span><span class="p">,</span> <span class="s2">&quot;Images&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_img_dir</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_img_dir</span><span class="p">)</span>

    <span class="n">bounding_rect</span> <span class="o">=</span> <span class="n">_get_bounding_rectangle</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">)</span>
    <span class="n">M</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">_compute_block_size</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">,</span> <span class="n">target_blocks_per_image</span><span class="p">,</span> <span class="n">bounding_rect</span><span class="p">)</span>
    <span class="c1"># M, N = _compute_mosaic_coefficient_of_variation(input_image_paths, global_nodata_value) # Aproach from the paper to compute bock size</span>

    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">input_image_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
        <span class="n">num_bands</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">count</span>

    <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing global reference block map&quot;</span><span class="p">)</span>
    <span class="n">block_ref_mean</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_compute_blocks</span><span class="p">(</span>
        <span class="n">input_image_paths</span><span class="p">,</span>
        <span class="n">bounding_rect</span><span class="p">,</span>
        <span class="n">M</span><span class="p">,</span>
        <span class="n">N</span><span class="p">,</span>
        <span class="n">num_bands</span><span class="p">,</span>
        <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata_val</span><span class="p">,</span>
        <span class="n">tile_width_and_height_tuple</span><span class="o">=</span><span class="n">tile_width_and_height_tuple</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span>
        <span class="n">_download_block_map</span><span class="p">(</span>
            <span class="n">block_map</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">block_ref_mean</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="n">nodata_val</span><span class="p">),</span>
            <span class="n">bounding_rect</span><span class="o">=</span><span class="n">bounding_rect</span><span class="p">,</span>
            <span class="n">output_image_path</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_image_folder</span><span class="p">,</span> <span class="s2">&quot;BlockReferenceMean&quot;</span><span class="p">,</span> <span class="s2">&quot;BlockReferenceMean.tif&quot;</span><span class="p">),</span>
            <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata_val</span><span class="p">,</span>
            <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">parallel</span> <span class="ow">and</span> <span class="n">max_workers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_workers</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>

    <span class="n">out_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">img_path</span> <span class="ow">in</span> <span class="n">input_image_paths</span><span class="p">:</span>
        <span class="n">in_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">img_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">out_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">img_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">output_local_basename</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_img_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_name</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>
        <span class="n">out_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">in_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing local block map&quot;</span><span class="p">)</span>
        <span class="n">block_loc_mean</span><span class="p">,</span> <span class="n">block_loc_count</span> <span class="o">=</span> <span class="n">_compute_blocks</span><span class="p">(</span>
            <span class="p">[</span><span class="n">img_path</span><span class="p">],</span>
            <span class="n">bounding_rect</span><span class="p">,</span>
            <span class="n">M</span><span class="p">,</span>
            <span class="n">N</span><span class="p">,</span>
            <span class="n">num_bands</span><span class="p">,</span>
            <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata_val</span><span class="p">,</span>
            <span class="n">tile_width_and_height_tuple</span><span class="o">=</span><span class="n">tile_width_and_height_tuple</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># block_local_mean = _smooth_array(block_local_mean, nodata_value=global_nodata_value)</span>

        <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span>
            <span class="n">_download_block_map</span><span class="p">(</span>
                <span class="n">block_map</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">block_loc_mean</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="n">nodata_val</span><span class="p">),</span>
                <span class="n">bounding_rect</span><span class="o">=</span><span class="n">bounding_rect</span><span class="p">,</span>
                <span class="n">output_image_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_image_folder</span><span class="p">,</span> <span class="s2">&quot;BlockLocalMean&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_name</span><span class="si">}</span><span class="s2">_BlockLocalMean.tif&quot;</span><span class="p">),</span>
                <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata_val</span><span class="p">,</span>
                <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">_download_block_map</span><span class="p">(</span>
                <span class="n">block_map</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">block_loc_count</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="n">nodata_val</span><span class="p">),</span>
                <span class="n">bounding_rect</span><span class="o">=</span><span class="n">bounding_rect</span><span class="p">,</span>
                <span class="n">output_image_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_image_folder</span><span class="p">,</span> <span class="s2">&quot;BlockLocalCount&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_name</span><span class="si">}</span><span class="s2">_BlockLocalCount.tif&quot;</span><span class="p">),</span>
                <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata_val</span><span class="p">,</span>
                <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing local correction, applying, and saving&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">num_bands</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">output_dtype</span><span class="p">,</span> <span class="s2">&quot;nodata&quot;</span><span class="p">:</span> <span class="n">nodata_val</span><span class="p">})</span>
            <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">meta</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">tile_width_and_height_tuple</span><span class="p">:</span>
                    <span class="n">tw</span><span class="p">,</span> <span class="n">th</span> <span class="o">=</span> <span class="n">tile_width_and_height_tuple</span>
                    <span class="n">windows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_create_windows</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">th</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">windows</span> <span class="o">=</span> <span class="p">[</span><span class="n">Window</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">height</span><span class="p">)]</span>

                <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
                    <span class="n">ctx</span> <span class="o">=</span> <span class="n">_choose_context</span><span class="p">(</span><span class="n">prefer_fork</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="n">pool</span> <span class="o">=</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span>
                        <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
                        <span class="n">mp_context</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                        <span class="n">initializer</span><span class="o">=</span><span class="n">_init_worker</span><span class="p">,</span>
                        <span class="n">initargs</span><span class="o">=</span><span class="p">(</span><span class="n">img_path</span><span class="p">,),</span>
                    <span class="p">)</span>

                    <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">pool</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">_compute_tile_local</span><span class="p">,</span>
                                    <span class="n">w</span><span class="p">,</span>
                                    <span class="n">b</span><span class="p">,</span>
                                    <span class="n">M</span><span class="p">,</span>
                                    <span class="n">N</span><span class="p">,</span>
                                    <span class="n">bounding_rect</span><span class="p">,</span>
                                    <span class="n">block_ref_mean</span><span class="p">,</span>
                                    <span class="n">block_loc_mean</span><span class="p">,</span>
                                    <span class="n">nodata_val</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="p">,</span>
                                    <span class="n">correction_method</span><span class="p">,</span>
                                    <span class="n">calculation_dtype_precision</span><span class="p">,</span>
                                    <span class="n">debug_mode</span><span class="p">,</span>
                                    <span class="p">)</span>
                        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">windows</span>
                    <span class="p">]</span>
                    <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
                        <span class="n">win</span><span class="p">,</span> <span class="n">b_idx</span><span class="p">,</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">fut</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                        <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">output_dtype</span><span class="p">),</span> <span class="n">b_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">win</span><span class="p">)</span>
                    <span class="n">pool</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_init_worker</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">win</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
                            <span class="n">win_</span><span class="p">,</span> <span class="n">b_idx</span><span class="p">,</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">_compute_tile_local</span><span class="p">(</span>
                                <span class="n">win</span><span class="p">,</span>
                                <span class="n">b</span><span class="p">,</span>
                                <span class="n">M</span><span class="p">,</span>
                                <span class="n">N</span><span class="p">,</span>
                                <span class="n">bounding_rect</span><span class="p">,</span>
                                <span class="n">block_ref_mean</span><span class="p">,</span>
                                <span class="n">block_loc_mean</span><span class="p">,</span>
                                <span class="n">nodata_val</span><span class="p">,</span>
                                <span class="n">alpha</span><span class="p">,</span>
                                <span class="n">correction_method</span><span class="p">,</span>
                                <span class="n">calculation_dtype_precision</span><span class="p">,</span>
                                <span class="n">debug_mode</span>
                            <span class="p">)</span>
                            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">output_dtype</span><span class="p">),</span> <span class="n">b_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">win_</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished local matching&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    2025-05-02
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "search.highlight"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>